<div class="review-container">
  <div class="review-box">
    <h3>Share your thoughts!</h3>
    <%= simple_form_for [imaginary_friend, Review.new()] do |f| %>
      <%= f.input :comment %>
      <%= f.input :rating, collection: (1..5).to_a,
      label: "Rate your experience", input_html: {data: {controller: "star-rating"}} %>
      <%= f.submit 'Add', class: "btn-ghost", style: "width: 120px" %>
    <% end %>
  </div>
  <div class="review-box">
      <div class="w-100">
        <h3 style="text-align: left">Reviews</h3>
        <% unless imaginary_friend.reviews.count == 0 %>
          <p>Average Rating:
            <% sum = 0 %>
            <% imaginary_friend.reviews.each do |review| %>
              <% sum += review.rating %>
            <% end %>
            <% average_score = sum.to_f/imaginary_friend.reviews.count %>
            <%= average_score.truncate(2) %>
            <% average_score.floor.times do %>
              <i class="fa-solid fa-star" style="color: #F49D1A"></i>
            <% end %>
            <% unless average_score.floor == average_score %>
              <i class="fa-solid fa-star-half-stroke" style="color: #F49D1A; font-size: 14px"></i>
            <% end %>
          </p>
        <% end %>
      </div>
      <ul class="w-100">
        <% imaginary_friend.reviews.each do |review| %>
          <li class="mb-2 d-flex flex-wrap card-review">
            <div class="w-100" data-controller="star-rating">
              <% review.rating.times do %>
                <i class="fa-solid fa-star" style="color: #F49D1A"></i>
              <% end %>
              <small class="text-muted">posted <%= time_ago_in_words(review.created_at) %> ago</small>
            </div>
            <div class="w-100">
              <%= review.comment %>
            </div>
            <div class="inner-flex">
              <% if review.user == current_user %>
                <%# <%= link_to "Edit", imaginary_friend_review_path(review), class:"buttons btn btn-primary" %>
                <%= link_to 'Delete',
                          imaginary_friend_review_path(review.imaginary_friend, review),
                          data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class:"btn btn-warning" %>
                <%# <%= button_to "delete", imaginary_friend_review_path(id: review.id, imaginary_friend_id: review.imaginary_friend.id), :method => :delete %>
              <% end %>
            </div>

          </li>
        <% end %>
      </ul>
  </div>
</div>
